# üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–º–µ–Ω—É —Å—Ç–∞—Ç—É—Å–æ–≤ –∞–ª—å–±–æ–º–æ–≤

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. ‚úÖ –ó–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–µ—Ä (`npm run dev` –≤ –ø–∞–ø–∫–µ `server`)
2. ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è 008 (—Ç–∞–±–ª–∏—Ü–∞ `album_status_history`)
3. ‚úÖ Telegram –±–æ—Ç –∑–∞–ø—É—â–µ–Ω
4. ‚úÖ –°–æ–∑–¥–∞–Ω –ø—Ä–æ–µ–∫—Ç —Å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º Telegram –∫–∞–Ω–∞–ª–æ–º

---

## üöÄ –®–∞–≥–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é

```bash
cd server
npm run migrate
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL:
```sql
USE klamonline;
SOURCE migrations/008_add_album_status_history.sql;
```

### 2. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç

1. –í–æ–π–¥–∏—Ç–µ –≤ KlamBot.ru
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
3. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —É–∫–∞–∂–∏—Ç–µ Telegram Chat ID (–ø–æ–ª—É—á–∏—Ç–µ –µ–≥–æ –æ—Ç –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ–π `/chatid`)
4. –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–ª—å–±–æ–º–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ê–†-001, –ö–†-002, –ê–†-003)

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–º–µ–Ω—É —Å—Ç–∞—Ç—É—Å–æ–≤ —á–µ—Ä–µ–∑ Telegram

–ù–∞–ø–∏—à–∏—Ç–µ –≤ Telegram –∫–∞–Ω–∞–ª–µ –ø—Ä–æ–µ–∫—Ç–∞:

```
–ê–†-001 –æ–∫
```

–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å:
```
‚úÖ –ê–ª—å–±–æ–º –ê–†-001 ‚Üí –ü—Ä–∏–Ω—è—Ç–æ
```

### 4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∞–ª–∏–∞—Å—ã

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:

```
–ö–†-002 –∑–∞–º–µ—á–∞–Ω–∏—è
```

```
–ê–†-003 +
```

```
–ö–†-002 –æ—Ç–ø—Ä–∞–≤–∏–ª
```

### 5. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```
–ê–†-001 –æ–∫
–ö–†-002 !
–ê–†-003 ‚Üí 
```

### 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ API

**–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ API:**
```bash
curl -X PUT http://localhost:3001/api/companies/1/projects/1/albums/1/status \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"statusCode": "accepted", "comment": "–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ"}'
```

**–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é:**
```bash
curl http://localhost:3001/api/companies/1/projects/1/albums/1/status-history \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∞–ª—å–±–æ–º–∞
SELECT a.code, a.name, ast.name as status
FROM albums a
JOIN album_statuses ast ON a.status_id = ast.id
WHERE a.code = '–ê–†-001';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π
SELECT 
  h.created_at,
  a.code as album_code,
  old_st.name as old_status,
  new_st.name as new_status,
  h.changed_by_telegram_id
FROM album_status_history h
JOIN albums a ON h.album_id = a.id
LEFT JOIN album_statuses old_st ON h.old_status_id = old_st.id
JOIN album_statuses new_st ON h.new_status_id = new_st.id
ORDER BY h.created_at DESC
LIMIT 10;
```

---

## ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

1. ‚úÖ –°—Ç–∞—Ç—É—Å –∞–ª—å–±–æ–º–∞ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –≤ –ë–î
2. ‚úÖ –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è –≤ `album_status_history`
3. ‚úÖ –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤ Telegram
4. ‚úÖ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
5. ‚úÖ –ü–æ–ª–µ `last_status_at` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

---

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ë–æ—Ç –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω (`initBot()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `server/src/index.ts`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `TELEGRAM_BOT_TOKEN` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `.env`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### –ê–ª—å–±–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–¥ –∞–ª—å–±–æ–º–∞ –Ω–∞–ø–∏—Å–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (—Å —É—á–µ—Ç–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É Telegram —á–∞—Ç—É
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SQL –∑–∞–ø—Ä–æ—Å –≤ –ª–æ–≥–∞—Ö

### –°—Ç–∞—Ç—É—Å –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∞–ª–∏–∞—Å –≤–∞–ª–∏–¥–Ω—ã–π (—Å–º. —Å–ø–∏—Å–æ–∫ –≤ `STATUS_ALIASES_GUIDE.md`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `album_statuses` - –≤—Å–µ —Å—Ç–∞—Ç—É—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–∞–º
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î

---

## üìù –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–ë–æ—Ç –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:

```
üìã Detected 1 status change command(s) in chat -1001234567890
‚úÖ Updated album –ê–†-001 status from 1 to 4
```

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞.

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ:

1. –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞
2. –î–æ–±–∞–≤–∏—Ç—å inline-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/status –ê–†-001` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
4. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (–∫—Ç–æ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã)
